<!DOCTYPE html>
<html lang="ar" dir="rtl" id="html-tag">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>News Radar | Ø±Ø§Ø¯Ø§Ø± Ø§Ù„Ø£Ø®Ø¨Ø§Ø±</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root { --primary: #e63946; --dark: #121212; --panel: #1e1e1e; --text: #ffffff; }
        body { margin: 0; display: flex; height: 100vh; font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--dark); color: var(--text); overflow: hidden; }
        
        /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© */
        #sidebar { width: 380px; background: var(--panel); border-left: 1px solid #333; display: flex; flex-direction: column; z-index: 1000; transition: all 0.3s ease; }
        [dir="ltr"] #sidebar { border-left: none; border-right: 1px solid #333; }
        
        .header { background: var(--primary); padding: 20px; text-align: center; font-size: 1.3em; font-weight: bold; }
        #stats { background: #252525; padding: 8px; text-align: center; font-size: 0.85em; color: #888; border-bottom: 1px solid #333; }
        
        #news-list { flex-grow: 1; overflow-y: auto; padding: 15px; }
        .news-item { background: #2a2a2a; margin-bottom: 10px; padding: 12px; border-radius: 6px; border-right: 4px solid var(--primary); text-decoration: none; color: white; display: block; animation: fadeIn 0.5s; }
        [dir="ltr"] .news-item { border-right: none; border-left: 4px solid var(--primary); }
        
        #map { flex-grow: 1; filter: invert(100%) hue-rotate(180deg) brightness(95%) contrast(90%); }

        /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¹Ù„ÙˆÙŠØ© */
        #controls { position: absolute; top: 15px; right: 15px; z-index: 1001; display: flex; gap: 8px; }
        [dir="ltr"] #controls { right: auto; left: 15px; }
        .btn { background: #333; color: white; border: 1px solid var(--primary); padding: 8px 15px; border-radius: 20px; cursor: pointer; font-size: 0.8em; }
        .btn.active { background: var(--primary); }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <div id="controls">
        <button class="btn" onclick="toggleLanguage()" id="lang-btn">English</button>
        <button class="btn" id="audio-btn" onclick="enableAudio()">ðŸ”Š</button>
    </div>

    <div id="sidebar">
        <div class="header" id="ui-title">Ø±Ø§Ø¯Ø§Ø± Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ù…Ø¨Ø§Ø´Ø±</div>
        <div id="stats"><span id="ui-stats">Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ù…Ø±ØµÙˆØ¯Ø©:</span> <span id="count">0</span></div>
        <div id="news-list"></div>
    </div>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>

    <script>
        const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSwHGhFEF1yL4wxSzY3tlFFIPIvjLDkEfTrQwg4dQgr3IJNzwBANp7QOS5gkQthMnKwgfExwt_gL1Lu/pub?output=csv';
        let currentLang = 'ar';
        let audioActive = false;
        let lastData = [];
        const alertSound = new Audio('https://assets.mixkit.co/active_storage/sfx/2358/2358-preview.mp3');

        const translations = {
            ar: { title: "Ø±Ø§Ø¯Ø§Ø± Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ù…Ø¨Ø§Ø´Ø±", stats: "Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ù…Ø±ØµÙˆØ¯Ø©:", langBtn: "English", loading: "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¬Ù„Ø¨..." },
            en: { title: "Live News Radar", stats: "Detected News:", langBtn: "Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©", loading: "Loading..." }
        };

        var map = L.map('map', { zoomControl: false }).setView([25, 45], 4);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

        function toggleLanguage() {
            currentLang = currentLang === 'ar' ? 'en' : 'ar';
            document.getElementById('html-tag').dir = currentLang === 'ar' ? 'rtl' : 'ltr';
            document.getElementById('html-tag').lang = currentLang;
            
            document.getElementById('ui-title').innerText = translations[currentLang].title;
            document.getElementById('ui-stats').innerText = translations[currentLang].stats;
            document.getElementById('lang-btn').innerText = translations[currentLang].langBtn;
            renderNews(lastData);
        }

        function enableAudio() {
            audioActive = true;
            document.getElementById('audio-btn').classList.add('active');
        }

        function fetchData() {
            Papa.parse(csvUrl, {
                download: true, header: true,
                complete: function(results) {
                    const data = results.data.filter(r => r.Title);
                    if (data.length > lastData.length && lastData.length !== 0 && audioActive) {
                        alertSound.play();
                    }
                    lastData = data;
                    renderNews(data);
                }
            });
        }

        function renderNews(news) {
            const list = document.getElementById('news-list');
            document.getElementById('count').innerText = news.length;
            list.innerHTML = '';
            
            map.eachLayer((layer) => { if (layer instanceof L.Marker) map.removeLayer(layer); });

            [...news].reverse().forEach(item => {
                const card = document.createElement('a');
                card.className = 'news-item';
                card.href = item.Link;
                card.target = '_blank';
                card.innerHTML = `<h4>${item.Title}</h4>`;
                list.appendChild(card);

                const lat = 15 + Math.random() * 25;
                const lng = 30 + Math.random() * 25;
                L.marker([lat, lng]).addTo(map).bindPopup(item.Title);
            });
        }

        setInterval(fetchData, 30000);
        fetchData();
    </script>
</body>
</html>

