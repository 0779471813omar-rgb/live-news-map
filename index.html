<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø±Ø§Ø¯Ø§Ø± Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ø°ÙƒÙŠ | Ø¨Ø« Ù…Ø¨Ø§Ø´Ø±</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root { --primary: #e63946; --dark: #1a1a1a; --light: #f1faee; }
        body { margin: 0; display: flex; height: 100vh; font-family: 'Segoe UI', system-ui, sans-serif; background: var(--dark); color: var(--light); overflow: hidden; }
        
        #sidebar { width: 400px; background: #222; border-left: 1px solid #444; display: flex; flex-direction: column; z-index: 1000; box-shadow: 5px 0 15px rgba(0,0,0,0.5); }
        .header { background: var(--primary); padding: 25px; text-align: center; font-size: 1.4em; font-weight: 800; letter-spacing: 1px; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        
        #stats { background: #333; padding: 10px; text-align: center; font-size: 0.9em; border-bottom: 1px solid #444; color: #aaa; }
        
        #news-list { flex-grow: 1; overflow-y: auto; padding: 10px; }
        .news-item { background: #2c2c2c; margin-bottom: 12px; padding: 15px; border-radius: 8px; border-right: 4px solid var(--primary); transition: 0.3s; cursor: pointer; text-decoration: none; color: white; display: block; animation: slideIn 0.5s ease; }
        .news-item:hover { background: #3d3d3d; transform: scale(1.02); }
        .news-item h4 { margin: 0; font-size: 1.05em; line-height: 1.4; }
        
        #map { flex-grow: 1; filter: grayscale(0.8) invert(1) contrast(1.2); } /* Dark Mode Map */
        
        #controls { position: absolute; top: 20px; right: 20px; z-index: 1000; display: flex; gap: 10px; }
        .btn { background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 30px; cursor: pointer; font-weight: bold; box-shadow: 0 4px 15px rgba(230, 57, 70, 0.4); }
        .btn.active { background: #2a9d8f; }

        @keyframes slideIn { from { opacity: 0; transform: translateX(20px); } to { opacity: 1; transform: translateX(0); } }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(230, 57, 70, 0.7); } 70% { box-shadow: 0 0 0 15px rgba(230, 57, 70, 0); } 100% { box-shadow: 0 0 0 0 rgba(230, 57, 70, 0); } }
        .new-news-flash { animation: pulse 2s infinite; }
    </style>
</head>
<body>

    <div id="controls">
        <button id="audio-btn" class="btn" onclick="enableAudio()">ğŸ”Š ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ù†Ø°Ø§Ø± Ø§Ù„ØµÙˆØªÙŠ</button>
    </div>

    <div id="sidebar">
        <div class="header">LIVE NEWS RADAR</div>
        <div id="stats">Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ù…Ø±ØµÙˆØ¯Ø© Ø§Ù„ÙŠÙˆÙ…: <span id="count">0</span></div>
        <div id="news-list"></div>
    </div>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>

    <script>
        const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSwHGhFEF1yL4wxSzY3tlFFIPIvjLDkEfTrQwg4dQgr3IJNzwBANp7QOS5gkQthMnKwgfExwt_gL1Lu/pub?output=csv';
        
        var map = L.map('map', { zoomControl: false }).setView([25, 45], 4);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

        let lastCount = 0;
        let audioActive = false;
        const alertSound = new Audio('https://assets.mixkit.co/active_storage/sfx/2358/2358-preview.mp3');

        function enableAudio() {
            audioActive = true;
            document.getElementById('audio-btn').classList.add('active');
            document.getElementById('audio-btn').innerText = 'ğŸ”” Ø§Ù„Ø±Ø§Ø¯Ø§Ø± ÙŠØ¹Ù…Ù„ Ø¨ØµÙˆØª';
        }

        function updateRadar() {
            Papa.parse(csvUrl, {
                download: true, header: true,
                complete: function(results) {
                    const data = results.data.filter(r => r.Title);
                    if (data.length > lastCount) {
                        if (audioActive && lastCount !== 0) alertSound.play();
                        renderNews(data);
                        lastCount = data.length;
                    }
                }
            });
        }

        function renderNews(news) {
            const list = document.getElementById('news-list');
            document.getElementById('count').innerText = news.length;
            list.innerHTML = '';
            
            // Ù…Ø³Ø­ Ø§Ù„Ù…Ø§Ø±ÙƒØ±Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
            map.eachLayer((layer) => { if (layer instanceof L.Marker) map.removeLayer(layer); });

            news.reverse().forEach((item, index) => {
                // Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©
                const card = document.createElement('a');
                card.className = `news-item ${index === 0 ? 'new-news-flash' : ''}`;
                card.href = item.Link;
                card.target = '_blank';
                card.innerHTML = `<h4>${item.Title}</h4>`;
                list.appendChild(card);

                // Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø®Ø±ÙŠØ·Ø© (ØªÙˆØ²ÙŠØ¹ Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ø­ÙˆÙ„ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø´Ø±Ù‚ Ø§Ù„Ø£ÙˆØ³Ø·)
                const lat = 15 + Math.random() * 25;
                const lng = 30 + Math.random() * 25;
                L.marker([lat, lng]).addTo(map).bindPopup(`<b>${item.Title}</b>`);
            });
        }

        setInterval(updateRadar, 30000); // ØªØ­Ø¯ÙŠØ« ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©
        updateRadar();
    </script>
</body>
</html>

