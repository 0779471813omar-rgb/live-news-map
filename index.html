<!DOCTYPE html>
<html lang="ar" dir="rtl" id="html-tag">
<head>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-FVT2Q9K6');</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>News Radar | Ø±Ø§Ø¯Ø§Ø± Ø§Ù„Ø£Ø®Ø¨Ø§Ø±</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root { --primary: #e63946; --dark: #121212; --panel: #1e1e1e; --text: #ffffff; }
        body { margin: 0; padding: 0; display: flex; flex-direction: column; height: 100vh; font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--dark); color: var(--text); overflow: hidden; }
        
        #top-bar { background: #000; padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--primary); z-index: 2000; }
        #main-container { display: flex; flex-grow: 1; overflow: hidden; }

        #sidebar { width: 380px; background: var(--panel); border-left: 1px solid #333; display: flex; flex-direction: column; z-index: 1000; }
        [dir="ltr"] #sidebar { border-left: none; border-right: 1px solid #333; }
        
        .header { background: var(--primary); padding: 15px; text-align: center; font-size: 1.2em; font-weight: bold; }
        #stats { background: #252525; padding: 8px; text-align: center; font-size: 0.85em; color: #888; border-bottom: 1px solid #333; }
        
        #news-list { flex-grow: 1; overflow-y: auto; padding: 15px; }
        .news-item { background: #2a2a2a; margin-bottom: 10px; padding: 12px; border-radius: 6px; border-right: 4px solid var(--primary); text-decoration: none; color: white; display: block; animation: fadeIn 0.5s; }
        [dir="ltr"] .news-item { border-right: none; border-left: 4px solid var(--primary); }
        
        #map { flex-grow: 1; filter: invert(100%) hue-rotate(180deg) brightness(95%) contrast(90%); }

        .btn { background: #333; color: white; border: 1px solid var(--primary); padding: 6px 15px; border-radius: 4px; cursor: pointer; font-size: 0.85em; transition: 0.3s; }
        .btn:hover { background: var(--primary); }
        .btn.active { background: #2a9d8f; border-color: #2a9d8f; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-FVT2Q9K6"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <div id="top-bar">
        <div style="font-weight: bold; color: var(--primary);">RADAR v2.0</div>
        <div style="display: flex; gap: 10px;">
            <button class="btn" onclick="toggleLanguage()" id="lang-btn">English</button>
            <button class="btn" id="audio-btn" onclick="enableAudio()">ğŸ”” ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª</button>
        </div>
    </div>

    <div id="main-container">
        <div id="sidebar">
            <div class="header" id="ui-title">Ø±Ø§Ø¯Ø§Ø± Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ù…Ø¨Ø§Ø´Ø±</div>
            <div id="stats"><span id="ui-stats">Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ù…Ø±ØµÙˆØ¯Ø©:</span> <span id="count">0</span></div>
            <div id="news-list"></div>
        </div>
        <div id="map"></div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>

    <script>
        const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSwHGhFEF1yL4wxSzY3tlFFIPIvjLDkEfTrQwg4dQgr3IJNzwBANp7QOS5gkQthMnKwgfExwt_gL1Lu/pub?output=csv';
        let currentLang = 'ar';
        let audioActive = false;
        let lastDataCount = 0;
        const alertSound = new Audio('https://assets.mixkit.co/active_storage/sfx/2358/2358-preview.mp3');

        const translations = {
            ar: { title: "Ø±Ø§Ø¯Ø§Ø± Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ù…Ø¨Ø§Ø´Ø±", stats: "Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ù…Ø±ØµÙˆØ¯Ø©:", langBtn: "English", audioBtn: "ğŸ”” ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª", audioOn: "ğŸ”Š Ø§Ù„ØµÙˆØª ÙŠØ¹Ù…Ù„" },
            en: { title: "Live News Radar", stats: "Detected News:", langBtn: "Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©", audioBtn: "ğŸ”” Enable Sound", audioOn: "ğŸ”Š Sound On" }
        };

        var map = L.map('map', { zoomControl: false }).setView([25, 45], 4);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

        function toggleLanguage() {
            currentLang = currentLang === 'ar' ? 'en' : 'ar';
            document.getElementById('html-tag').dir = currentLang === 'ar' ? 'rtl' : 'ltr';
            document.getElementById('ui-title').innerText = translations[currentLang].title;
            document.getElementById('ui-stats').innerText = translations[currentLang].stats;
            document.getElementById('lang-btn').innerText = translations[currentLang].langBtn;
            if(!audioActive) document.getElementById('audio-btn').innerText = translations[currentLang].audioBtn;
        }

        function enableAudio() {
            audioActive = true;
            document.getElementById('audio-btn').classList.add('active');
            document.getElementById('audio-btn').innerText = translations[currentLang].audioOn;
        }

        function fetchData() {
            Papa.parse(csvUrl, {
                download: true, header: true,
                complete: function(results) {
                    const data = results.data.filter(r => r.Title);
                    if (data.length > lastDataCount && lastDataCount !== 0 && audioActive) {
                        alertSound.play();
                    }
                    lastDataCount = data.length;
                    renderNews(data);
                }
            });
        }

        function renderNews(news) {
            const list = document.getElementById('news-list');
            document.getElementById('count').innerText = news.length;
            list.innerHTML = '';
            map.eachLayer((layer) => { if (layer instanceof L.Marker) map.removeLayer(layer); });

            [...news].reverse().forEach(item => {
                const card = document.createElement('a');
                card.className = 'news-item';
                card.href = item.Link; card.target = '_blank';
                card.innerHTML = `<h4>${item.Title}</h4>`;
                list.appendChild(card);
                L.marker([15 + Math.random() * 25, 30 + Math.random() * 25]).addTo(map).bindPopup(item.Title);
            });
        }

        setInterval(fetchData, 30000);
        fetchData();
    </script>
</body>
</html>
